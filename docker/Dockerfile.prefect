FROM prefecthq/prefect:2.14-python3.11

WORKDIR /app

# Install required packages directly with pip
RUN pip install --no-cache-dir \
    dbt-duckdb==1.8.1 \
    duckdb==0.10.0 \
    pyspark==3.5.0 \
    pandas==2.2.0 \
    pyarrow==15.0.0

COPY flows/ /app/flows/
COPY dbt/ /app/dbt/

CMD ["prefect", "server", "start", "--host", "0.0.0.0"]